<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SurveyPro - Field Questionnaire A-J (Dark Mode)</title>
  <!-- Font Awesome 6 + Google Inter for modern look -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* === DARK THEME ENHANCEMENTS (preserving all original functionality) === */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-deep: #0a0c15;
      --surface: rgba(18, 24, 38, 0.85);
      --surface-card: rgba(22, 28, 45, 0.8);
      --border-subtle: rgba(255, 255, 255, 0.04);
      --border-active: rgba(37, 99, 235, 0.4);
      --text-primary: #ffffff;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --accent-primary: #2563eb;
      --accent-secondary: #3b82f6;
      --accent-glow: rgba(37, 99, 235, 0.3);
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gradient-card: linear-gradient(145deg, rgba(22, 28, 45, 0.8), rgba(18, 24, 38, 0.9));
      --shadow-elevation: 0 30px 60px -15px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.02);
      --radius-card: 28px;
      --radius-input: 16px;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg-deep);
      padding: 30px 20px;
      color: var(--text-primary);
      position: relative;
      min-height: 100vh;
    }

    /* animated background */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background:
        radial-gradient(circle at 10% 20%, rgba(37, 99, 235, 0.12) 0%, transparent 40%),
        radial-gradient(circle at 90% 70%, rgba(16, 185, 129, 0.08) 0%, transparent 45%),
        radial-gradient(circle at 30% 80%, rgba(245, 158, 11, 0.06) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 10;
    }

    /* top bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 20px;
    }

    h2 {
      font-size: 2.2rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffffff, #a5c9ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    h2 i {
      color: var(--accent-primary);
      font-size: 2rem;
      background: rgba(37, 99, 235, 0.2);
      padding: 12px;
      border-radius: 20px;
      border: 1px solid rgba(37, 99, 235, 0.3);
    }

    .save-indicator {
      background: rgba(16, 185, 129, 0.1);
      backdrop-filter: blur(8px);
      padding: 12px 28px;
      border-radius: 60px;
      color: #6ee7b7;
      font-weight: 600;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 12px;
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .save-indicator i {
      color: #10b981;
    }

    .top-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .corner-btn {
      background: linear-gradient(145deg, #0ea5a3, #0f766e);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 60px;
      color: #fff;
      padding: 10px 16px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .corner-btn:hover {
      filter: brightness(1.06);
    }

    /* sections */
    .section {
      background: rgba(18, 24, 38, 0.7);
      backdrop-filter: blur(12px) saturate(180%);
      -webkit-backdrop-filter: blur(12px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-card);
      padding: 28px 30px;
      margin-bottom: 30px;
      box-shadow: var(--shadow-elevation);
      position: relative;
      overflow: hidden;
    }

    .section::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(600px circle at 20% 30%, rgba(37, 99, 235, 0.06), transparent 70%);
      pointer-events: none;
    }

    h3 {
      font-size: 1.8rem;
      font-weight: 700;
      color: white;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 25px;
      border-bottom: 2px solid rgba(37, 99, 235, 0.3);
      padding-bottom: 15px;
    }

    h3 i {
      color: var(--accent-primary);
      font-size: 2rem;
      background: rgba(37, 99, 235, 0.1);
      padding: 10px;
      border-radius: 16px;
    }

    h4 {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-secondary);
      margin: 25px 0 15px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    h4 i {
      color: var(--accent-secondary);
    }

    /* labels */
    label {
      display: block;
      font-weight: 500;
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-top: 18px;
      margin-bottom: 8px;
    }

    /* inputs & selects */
    input,
    select {
      width: 100%;
      padding: 14px 18px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-input);
      font-size: 0.95rem;
      font-family: 'Inter', sans-serif;
      color: var(--text-primary);
      box-shadow: inset 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      margin-bottom: 5px;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--accent-glow), inset 0 2px 8px rgba(0, 0, 0, 0.4);
      background: rgba(25, 32, 50, 0.8);
    }

    select option {
      background: #1a1f2e;
      color: white;
    }

    /* table styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      border-radius: 20px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.2);
    }

    th,
    td {
      padding: 14px 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    th {
      background: rgba(37, 99, 235, 0.15);
      color: white;
      font-weight: 600;
      border-bottom: 2px solid rgba(37, 99, 235, 0.3);
    }

    td {
      color: var(--text-secondary);
    }

    tr:hover td {
      background: rgba(255, 255, 255, 0.02);
    }

    /* score display */
    .score {
      background: rgba(37, 99, 235, 0.1);
      border: 1px solid rgba(37, 99, 235, 0.2);
      border-radius: 24px;
      padding: 18px 24px;
      margin-top: 20px;
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      backdrop-filter: blur(4px);
    }

    .score input[readonly] {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(37, 99, 235, 0.3);
      width: auto;
      min-width: 100px;
      display: inline-block;
      margin: 0 5px;
      font-weight: 600;
      color: white;
      cursor: default;
    }

    /* form footer */
    .form-footer {
      margin-top: 40px;
      text-align: center;
    }

    .form-footer button {
      background: linear-gradient(145deg, #2563eb, #1d4ed8);
      border: none;
      padding: 18px 54px;
      border-radius: 60px;
      font-size: 1.2rem;
      font-weight: 700;
      color: white;
      display: inline-flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 20px 30px -12px rgba(37, 99, 235, 0.5);
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.25s ease;
    }

    .form-footer button:hover {
      background: linear-gradient(145deg, #1d4ed8, #1e3a8a);
      transform: scale(1.02);
      box-shadow: 0 25px 35px -12px #2563eb;
    }

    .form-footer button i {
      font-size: 1.3rem;
    }

    /* special inputs */
    #kupp_total,
    #ses_class,
    #anemia_status,
    #ifa_dose {
      background: rgba(0, 0, 0, 0.3);
    }

    .ifa-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 16px;
    }

    .ifa-modal.show {
      display: flex;
    }

    .ifa-card {
      width: min(560px, 96vw);
      background: rgba(18, 24, 38, 0.97);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 18px;
      padding: 18px;
    }

    .ifa-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .ifa-head h4 {
      margin: 0;
      color: #fff;
    }

    .ifa-close {
      background: transparent;
      color: #cbd5e1;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .ifa-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .ifa-result {
      margin-top: 12px;
      background: rgba(14, 165, 163, 0.14);
      border: 1px solid rgba(14, 165, 163, 0.35);
      border-radius: 12px;
      padding: 12px;
      color: #c7f9f7;
      font-weight: 600;
    }

    /* responsive */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }

      h2 {
        font-size: 1.6rem;
      }

      .top-bar {
        flex-direction: column;
        align-items: flex-start;
      }

      .section {
        padding: 20px;
      }

      h3 {
        font-size: 1.4rem;
      }

      .score {
        flex-direction: column;
        align-items: flex-start;
      }

      table {
        display: block;
        overflow-x: auto;
      }

      .ifa-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>

  <div class="container">
    <!-- top bar with save indicator -->
    <div class="top-bar">
      <h2>
        <i class="fas fa-clipboard-list"></i>
        FIELD QUESTIONNAIRE (A-J)
      </h2>
      <div class="top-actions">
        <button type="button" class="corner-btn" id="openIfaCalculator">
          <i class="fas fa-calculator"></i> IFA Dose Calculator
        </button>
        <div class="save-indicator">
          <i class="fas fa-cloud-upload-alt"></i>
          Auto-sync enabled - progress saved
        </div>
      </div>
    </div>

    <div class="form-footer" style="margin-top: 0; margin-bottom: 20px;">
      <button type="button" onclick="window.location.href='/section-status'"><i class="fas fa-table"></i> Generate
        Section Status Table</button>
    </div>

    <div class="ifa-modal" id="ifaModal">
      <div class="ifa-card">
        <div class="ifa-head">
          <h4><i class="fas fa-syringe"></i> IFA Syrup Dose Calculator</h4>
          <button type="button" class="ifa-close" id="closeIfaCalculator">&times;</button>
        </div>
        <div class="ifa-grid">
          <div>
            <label for="ifa_calc_weight">Weight (kg)</label>
            <input type="number" step="0.1" id="ifa_calc_weight" placeholder="Enter weight">
          </div>
          <div>
            <label for="ifa_calc_hb">Hb value (g/dL)</label>
            <input type="number" step="0.1" id="ifa_calc_hb" placeholder="Enter Hb value">
          </div>
        </div>
        <div class="form-footer" style="margin-top: 14px;">
          <button type="button" id="runIfaCalculator"><i class="fas fa-bolt"></i> Calculate</button>
        </div>
        <div class="ifa-result" id="ifaCalcResult">Enter values and click Calculate.</div>
      </div>
    </div>

    <form method="POST" action="/form">
      <!-- ================= STUDY DETAILS ================= -->
      <div class="section">
        <h3><i class="fas fa-file-lines"></i> Field Questionnaire</h3>
        <p class="text-white-50 small mb-4">Validation and Cost-Effectiveness Assessment of a Non-invasive Haemoglobin
          Estimation Device Against a Program-Used Minimally Invasive Point-of-Care Haemoglobin Device and a Standard
          Haematology Analyzer for Anaemia Screening in Preschool Settings</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label>Study ID:</label>
            <input type="text" name="study_id" placeholder="Enter Study ID">
          </div>
          <div>
            <label>Name:</label>
            <input type="text" name="participant_name" value="{{ profile.name }}" readonly>
          </div>
          <div>
            <label>Date:</label>
            <input type="date" name="study_date" value="{{ today_date }}">
          </div>
          <div>
            <label>Height (Cms):</label>
            <input type="number" step="0.1" name="height_cms" placeholder="Enter height in cms">
          </div>
          <div>
            <label>Weight (Kgs):</label>
            <input type="number" step="0.1" id="weight_input" name="weight_kgs" placeholder="Enter weight in kgs">
          </div>
          <div>
            <label>Mobile No. (10 Digits):</label>
            <input type="tel" name="mobile_no" pattern="[0-9]{10}" maxlength="10" placeholder="10 Digits Mandate">
          </div>
          <div>
            <label>School/Anganwadi Name:</label>
            <input type="text" name="school_anganwadi_name" value="{{ profile.school }}">
          </div>
          <div>
            <label>Location:</label>
            <select name="location_type">
              <option>Urban</option>
              <option>Urban Slum</option>
            </select>
          </div>
          <div style="grid-column: span 2;">
            <label>Investigator Name:</label>
            <input type="text" name="investigator_name" placeholder="Enter Investigator Name">
          </div>
        </div>
      </div>

      <!-- ================= SECTION A ================= -->
      <div class="section">
        <h3>Section A: Participant Identification</h3>
        <label>1. Child ID Code:</label>
        <input type="text" name="child_id_code" placeholder="Enter Child ID">

        <label>2. DOB:</label>
        <input type="date" name="dob" value="{{ profile.dob }}">

        <label>Age (completed years):</label>
        <div style="display: flex; gap: 20px;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="age_completed"
              value="3" style="width: auto;"> 3</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="age_completed"
              value="4" style="width: auto;"> 4</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="age_completed"
              value="5" style="width: auto;"> 5</label>
        </div>

        <label>3. Sex:</label>
        <div style="display: flex; gap: 20px;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="sex" value="Male"
              style="width: auto;"> Male</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="sex" value="Female"
              style="width: auto;"> Female</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="sex" value="Other"
              style="width: auto;"> Other</label>
        </div>

        <label>4. Birth Order of Child:</label>
        <div style="display: flex; gap: 20px;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="birth_order" value="1"
              style="width: auto;"> 1</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="birth_order" value="2"
              style="width: auto;"> 2</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="birth_order" value="3"
              style="width: auto;"> 3</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="birth_order"
              value=">=4" style="width: auto;"> ≥4</label>
        </div>

        <label>5. Number of siblings:</label>
        <input type="number" name="siblings_count" placeholder="Enter count">
      </div>

      <!-- ================= SECTION B ================= -->
      <div class="section">
        <h3>Section B: Socio Demographic & Socio Economic Details</h3>
        <h4>B1. Family Characteristics</h4>
        <label>6. Type of family:</label>
        <div style="display: flex; gap: 20px;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="family_type"
              value="Nuclear" style="width: auto;"> Nuclear</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="family_type"
              value="Joint" style="width: auto;"> Joint</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="family_type"
              value="Extended" style="width: auto;"> Extended</label>
        </div>

        <label>7. Total number of family members living in the household:</label>
        <input type="number" name="family_members_total" placeholder="Enter count">

        <label>8. Religion:</label>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="religion" value="Hindu"
              style="width: auto;"> Hindu</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="religion"
              value="Muslim" style="width: auto;"> Muslim</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="religion"
              value="Christian" style="width: auto;"> Christian</label>
          <label style="display: flex; align-items: center; gap: 10px; min-width: 150px;">
            <input type="radio" name="religion" value="Other" style="width: auto;"> Other:
            <input type="text" name="religion_other" style="padding: 5px; height: 30px;" placeholder="Specify">
          </label>
        </div>

        <label>9. Caste / Social category:</label>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="social_category"
              value="SC" style="width: auto;"> SC</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="social_category"
              value="ST" style="width: auto;"> ST</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="social_category"
              value="OBC" style="width: auto;"> OBC</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="social_category"
              value="General" style="width: auto;"> General</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="social_category"
              value="Prefer not to say" style="width: auto;"> Prefer not to say</label>
        </div>

        <h4 class="mt-4">B2. Modified Kuppuswamy Socio Economic Scale (Urban)</h4>
        <label>10. Education level of head of family:</label>
        <select id="edu_head" name="edu_head_family">
          <option value="7">Profession / Honours (Score 7)</option>
          <option value="6">Graduate / Postgraduate (Score 6)</option>
          <option value="5">Intermediate / Diploma (Score 5)</option>
          <option value="4">High School Certificate (Score 4)</option>
          <option value="3">Middle School Certificate (Score 3)</option>
          <option value="2">Primary School Certificate (Score 2)</option>
          <option value="1">Illiterate (Score 1)</option>
        </select>

        <label>11. Occupation of head of family:</label>
        <select id="occ_head" name="occupation_head_family">
          <option value="10">Legislators, senior officials and managers (Score 10)</option>
          <option value="9">Profession (Score 9)</option>
          <option value="8">Technicians and associate professionals (Score 8)</option>
          <option value="7">Clerks (Score 7)</option>
          <option value="6">Skilled workers and shop and market sales workers (Score 6)</option>
          <option value="5">Skilled agricultural and fishery workers (Score 5)</option>
          <option value="4">Craft and related trade workers (Score 4)</option>
          <option value="3">Plant and machine operators and assemblers (Score 3)</option>
          <option value="2">Elementary occupation (Score 2)</option>
          <option value="1">Unemployed (Score 1)</option>
        </select>

        <label>12. Total monthly family income (₹):</label>
        <select id="income" name="monthly_income">
          <option value="12">₹1,59,586 and above (Score 12)</option>
          <option value="10">₹79,756 – ₹1,59,585 (Score 10)</option>
          <option value="6">₹59,795 – ₹79,755 (Score 6)</option>
          <option value="4">₹39,830 – ₹59,794 (Score 4)</option>
          <option value="3">₹23,870 – ₹39,829 (Score 3)</option>
          <option value="2">₹7,989 – ₹23,869 (Score 2)</option>
          <option value="1">≤₹7,988 (Score 1)</option>
        </select>

        <div class="score">
          <span>13. Total Score: <input name="kuppuswamy_total_score" id="kupp_total" readonly></span>
          <span style="color: var(--text-muted);">|</span>
          <span>14. SES Class: <input name="ses_class" id="ses_class" readonly></span>
        </div>
      </div>

      <!-- ================= SECTION E ================= -->
      <div class="section">
        <h3>Section E: Child Health & Nutrition History</h3>
        <label>15. History of low birth weight (<2.5 kg)?</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="low_birth_weight"
                  value="Yes" style="width: auto;"> Yes</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="low_birth_weight"
                  value="No" style="width: auto;"> No</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="low_birth_weight"
                  value="Don’t know" style="width: auto;"> Don’t know</label>
            </div>

            <label>16. Any known chronic illness (heart disease, kidney disease, TB, etc.)?</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="chronic_illness"
                  value="Yes" style="width: auto;"> Yes</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="chronic_illness"
                  value="No" style="width: auto;"> No</label>
            </div>
            <input type="text" name="chronic_illness_specify" placeholder="If yes, specify">

            <label>17. History of worm infestation in last 6 months?</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="worm_infestation"
                  value="Yes" style="width: auto;"> Yes</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="worm_infestation"
                  value="No" style="width: auto;"> No</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="worm_infestation"
                  value="Don’t know" style="width: auto;"> Don’t know</label>
            </div>

            <label>18. Has the child received deworming tablet in the last 6 months?</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="deworming_tablet"
                  value="Yes" style="width: auto;"> Yes</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="deworming_tablet"
                  value="No" style="width: auto;"> No</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="deworming_tablet"
                  value="Don’t know" style="width: auto;"> Don’t know</label>
            </div>

            <label>19. Is the child currently receiving iron supplementation (IFA syrup/tablet)?</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio"
                  name="iron_supplementation" value="Yes" style="width: auto;"> Yes</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio"
                  name="iron_supplementation" value="No" style="width: auto;"> No</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio"
                  name="iron_supplementation" value="Don’t know" style="width: auto;"> Don’t know</label>
            </div>
      </div>

      <!-- ================= SECTION F ================= -->
      <div class="section">
        <h3>Section F: Dietary Practices</h3>
        <label>20. Type of diet:</label>
        <div style="display: flex; gap: 20px;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="diet_type"
              value="Vegetarian" style="width: auto;"> Vegetarian</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="diet_type"
              value="Mixed" style="width: auto;"> Mixed</label>
        </div>

        <label>21. Frequency of consumption of iron rich foods:</label>
        <table>
          <thead>
            <tr>
              <th>Food Item</th>
              <th>Daily</th>
              <th>3–4/week</th>
              <th>1–2/week</th>
              <th>Rarely</th>
              <th>Never</th>
            </tr>
          </thead>
          <tbody>
            {% for item, name in [('green_leafy', 'Green leafy vegetables'), ('jaggery', 'Jaggery'), ('dates', 'Dates'),
            ('eggs', 'Eggs'), ('meat', 'Meat'), ('fruits', 'Fruits')] %}
            <tr>
              <td>{{ name }}</td>
              <td><input type="radio" name="freq_{{ item }}" value="Daily"></td>
              <td><input type="radio" name="freq_{{ item }}" value="3-4/week"></td>
              <td><input type="radio" name="freq_{{ item }}" value="1-2/week"></td>
              <td><input type="radio" name="freq_{{ item }}" value="Rarely"></td>
              <td><input type="radio" name="freq_{{ item }}" value="Never"></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- ================= SECTION G ================= -->
      <div class="section">
        <h3>Section G: History of Hemoglobin testing</h3>
        <label>22. Did the child previously get tested for hemoglobin?</label>
        <div style="display: flex; gap: 20px;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="hb_previously_tested"
              value="Yes" style="width: auto;"> Yes</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="hb_previously_tested"
              value="No" style="width: auto;"> No</label>
        </div>

        <div id="prev_hb_details" class="mt-3">
          <label>If yes, what is the result:</label>
          <input type="text" name="prev_hb_result" placeholder="Hb result">

          <label>Device used:</label>
          <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="prev_hb_device"
                value="Non-invasive" style="width: auto;"> 1. Non-invasive</label>
            <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="prev_hb_device"
                value="Minimally invasive" style="width: auto;"> 2. Minimally invasive</label>
            <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="prev_hb_device"
                value="Invasive" style="width: auto;"> 3. Invasive</label>
            <label style="display: flex; align-items: center; gap: 10px; min-width: 150px;">
              <input type="radio" name="prev_hb_device" value="Other" style="width: auto;"> 4. Others:
              <input type="text" name="prev_hb_device_other" style="padding: 5px; height: 30px;" placeholder="Specify">
            </label>
          </div>
        </div>
      </div>


      <!-- ================= SECTION H ================= -->

      <div class="section">
        <h3>Section H: Haemoglobin Measurement Results (To be filled after testing)</h3>

        <label>23. Device sequence used:</label>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" name="device_seq"
              value="Masimo Rad-67" style="width: auto;"> Masimo Rad-67</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" name="device_seq"
              value="Minimally invasive POC" style="width: auto;"> Minimally invasive POC</label>
          <label style="display: flex; align-items: center; gap: 8px;"><input type="checkbox" name="device_seq"
              value="ABX Micros ES 60" style="width: auto;"> ABX Micros ES 60</label>
        </div>


        <!-- Masimo Rad-67 -->
        <h4 class="mt-4 text-primary">Masimo Rad-67 (Non-invasive)</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label>24. Start time:</label>
            <input type="time" name="masimo_start_time">
          </div>
          <div>
            <label>25. Reading: _____ g/dL</label>
            <input type="number" step="0.1" name="masimo_reading" placeholder="Hb value">
          </div>
          <div style="grid-column: span 2;">
            <label>26. End time:</label>
            <input type="time" name="masimo_end_time">
          </div>
        </div>

        <label class="mt-3">27. FLACC Scale (Masimo):</label>
        <table>
          <thead>
            <tr>
              <th>Component</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Face: 0=Relaxed, 1=Occasional grimace/frown, 2=Frequent/constant quivering chin or clenched jaw</td>
              <td><select name="masimo_flacc_face" class="flacc_masimo">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Legs: 0=Normal/relaxed, 1=Uneasy/restless, 2=Kicking or drawn up</td>
              <td><select name="masimo_flacc_legs" class="flacc_masimo">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Activity: 0=Quiet/lying still, 1=Squirming/shifting/tense, 2=Arched/rigid/jerking</td>
              <td><select name="masimo_flacc_activity" class="flacc_masimo">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Cry: 0=No cry, 1=Moans/whimpers/occasional, 2=Steady crying/screaming/frequent complaints</td>
              <td><select name="masimo_flacc_cry" class="flacc_masimo">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Consolability: 0=Content/relaxed, 1=Reassured by touching/talking, 2=Difficult to console/comfort</td>
              <td><select name="masimo_flacc_consolability" class="flacc_masimo">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
          </tbody>
        </table>
        <div class="score">Total score: <input name="masimo_flacc_total" id="masimo_flacc_total" readonly> /10</div>

        <h5 class="mt-4">Operational Feasibility Questions (Masimo)</h5>
        <table>
          <thead>
            <tr>
              <th>Section</th>
              <th>Question</th>
              <th>Options</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>28. Ease of Operation & Workflow</td>
              <td>Is the device easy to operate by routine healthcare staff?</td>
              <td><select name="m_feas_28_a">
                  <option>Very easy</option>
                  <option>Easy</option>
                  <option>Moderate</option>
                  <option>Difficult</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Does the device fit well into existing clinical workflow?</td>
              <td><select name="m_feas_28_b">
                  <option>Yes</option>
                  <option>Partially</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td>29. Training & Skill Requirements</td>
              <td>Level of training required to operate the device</td>
              <td><select name="m_feas_29_a">
                  <option>None</option>
                  <option>Minimal</option>
                  <option>Moderate</option>
                  <option>Extensive</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Is the device operator-dependent?</td>
              <td><select name="m_feas_29_b">
                  <option>Low</option>
                  <option>Moderate</option>
                  <option>High</option>
                </select></td>
            </tr>
            <tr>
              <td>30. Maintenance & Technical Support</td>
              <td>Frequency of maintenance required</td>
              <td><select name="m_feas_30_a">
                  <option>Daily</option>
                  <option>Weekly</option>
                  <option>Monthly</option>
                  <option>Rare</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Availability of technical support and spare parts</td>
              <td><select name="m_feas_30_b">
                  <option>Easily available</option>
                  <option>Limited</option>
                  <option>Not available</option>
                </select></td>
            </tr>
            <tr>
              <td>31. Operational Time Suitability</td>
              <td>Can this device be used effectively in daily clinical operations?</td>
              <td><select name="m_feas_31_a">
                  <option>Yes</option>
                  <option>Partially</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Does this device save time or fit within real clinical time constraints?</td>
              <td><select name="m_feas_31_b">
                  <option>Yes</option>
                  <option>Neutral</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Average time required to obtain a result:</td>
              <td><select name="m_feas_31_c">
                  <option>&lt;1 min</option>
                  <option>1–3 min</option>
                  <option>&gt;3 min</option>
                </select></td>
            </tr>
            <tr>
              <td>32. Reliability in Daily Use</td>
              <td>Does the device provide consistent results in routine clinical use?</td>
              <td><select name="m_feas_32_a">
                  <option>Always</option>
                  <option>Often</option>
                  <option>Sometimes</option>
                  <option>Rarely</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Is the device affected by environmental factors?</td>
              <td><select name="m_feas_32_b">
                  <option>Not affected</option>
                  <option>Slightly affected</option>
                  <option>Highly affected</option>
                </select></td>
            </tr>
            <tr>
              <td>33. Portability & Power Requirement</td>
              <td>Is the device portable for field use?</td>
              <td><select name="m_feas_33_a">
                  <option>Highly portable</option>
                  <option>Moderately portable</option>
                  <option>Not portable</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Power requirement of the device</td>
              <td><select name="m_feas_33_b">
                  <option>Battery operated</option>
                  <option>Mains power</option>
                  <option>Both</option>
                </select></td>
            </tr>
            <tr>
              <td>34. Maintenance & Calibration</td>
              <td>Ease of routine maintenance and calibration</td>
              <td><select name="m_feas_34_a">
                  <option>Easy</option>
                  <option>Moderate</option>
                  <option>Difficult</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Frequency of calibration required</td>
              <td><select name="m_feas_34_b">
                  <option>Daily</option>
                  <option>Weekly</option>
                  <option>Monthly</option>
                  <option>Rare</option>
                </select></td>
            </tr>
            <tr>
              <td>35. Data Recording & Integration</td>
              <td>Does the device allow easy recording of results?</td>
              <td><select name="m_feas_35_a">
                  <option>Yes</option>
                  <option>Partially</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Can the device integrate with hospital information systems?</td>
              <td><select name="m_feas_35_b">
                  <option>Yes</option>
                  <option>No</option>
                  <option>Not applicable</option>
                </select></td>
            </tr>
            <tr>
              <td>36. Field Practicality</td>
              <td>Is the device suitable for use in peripheral/rural/field settings?</td>
              <td><select name="m_feas_36_a">
                  <option>Yes</option>
                  <option>Partially</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Does the device function reliably under non-laboratory conditions?</td>
              <td><select name="m_feas_36_b">
                  <option>Always</option>
                  <option>Often</option>
                  <option>Sometimes</option>
                  <option>Rarely</option>
                </select></td>
            </tr>
            <tr>
              <td>37. Device Safety</td>
              <td>Is the device safe for routine clinical use?</td>
              <td><select name="m_feas_37_a">
                  <option>Very safe</option>
                  <option>Safe</option>
                  <option>Moderately safe</option>
                  <option>Unsafe</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Does the device reduce risk of infection or biohazard exposure?</td>
              <td><select name="m_feas_37_b">
                  <option>Yes</option>
                  <option>Partially</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Have any safety issues or malfunctions been observed?</td>
              <td><select name="m_feas_37_c">
                  <option>None</option>
                  <option>Rare</option>
                  <option>Occasional</option>
                  <option>Frequent</option>
                </select></td>
            </tr>
            <tr>
              <td></td>
              <td>Is the device suitable for use in vulnerable patients?</td>
              <td><select name="m_feas_37_d">
                  <option>Yes</option>
                  <option>Partially</option>
                  <option>No</option>
                </select></td>
            </tr>
            <tr>
              <td>38. Overall Operational Feasibility</td>
              <td>Rate overall operational feasibility</td>
              <td><select name="m_feas_38_a">{% for i in range(1,6) %}<option>{{ i }}</option>{% endfor %}</select></td>
            </tr>
            <tr>
              <td></td>
              <td>Would you recommend this device for routine clinical use?</td>
              <td><select name="m_feas_38_b">
                  <option>Yes</option>
                  <option>No</option>
                  <option>Conditional</option>
                </select></td>
            </tr>
          </tbody>
        </table>

        <!-- Minimally Invasive POC Device -->
        <h4 class="mt-5 text-success">Minimally Invasive POC Device</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label>39. Start time:</label>
            <input type="time" name="poc_start_time">
          </div>
          <div>
            <label>40. Capillary Hb value: _____ g/dL</label>
            <input type="number" step="0.1" name="poc_hb_value" placeholder="Hb value">
          </div>
          <div>
            <label>41. Number of attempts:</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="poc_attempts"
                  value="1" style="width: auto;"> 1</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="poc_attempts"
                  value="2" style="width: auto;"> 2</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="poc_attempts"
                  value=">=3" style="width: auto;"> ≥3</label>
            </div>
          </div>
          <div>
            <label>42. End time:</label>
            <input type="time" name="poc_end_time">
          </div>
        </div>

        <label class="mt-3">43. FLACC Scale (POC):</label>
        <table>
          <thead>
            <tr>
              <th>Component</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Face</td>
              <td><select name="poc_flacc_face" class="flacc_poc">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Legs</td>
              <td><select name="poc_flacc_legs" class="flacc_poc">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Activity</td>
              <td><select name="poc_flacc_activity" class="flacc_poc">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Cry</td>
              <td><select name="poc_flacc_cry" class="flacc_poc">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Consolability</td>
              <td><select name="poc_flacc_consolability" class="flacc_poc">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
          </tbody>
        </table>
        <div class="score">Total score: <input name="poc_flacc_total" id="poc_flacc_total" readonly> /10</div>

        <h5 class="mt-4">Operational Feasibility Questions (POC)</h5>
        <table>
          <thead>
            <tr>
              <th>Section</th>
              <th>Question</th>
              <th>Response</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>44. Ease of Operation & Workflow</td>
              <td>Is it easy to operate?</td>
              <td><select name="poc_feas_44_a">
                  <option>Very easy</option>
                  <option>Easy</option>
                  <option>Moderate</option>
                  <option>Difficult</option>
                </select></td>
            </tr>
            <tr>
              <td>47. Average time required to obtain a result:</td>
              <td>Hemocue 301</td>
              <td><select name="poc_feas_47_c">
                  <option>&lt;1 min</option>
                  <option>1–3 min</option>
                  <option>&gt;3 min</option>
                </select></td>
            </tr>
            <tr>
              <td>54. Overall Operational Feasibility</td>
              <td>Rate overall feasibility</td>
              <td><select name="poc_overall_feas">{% for i in range(1,6) %}<option>{{ i }}</option>{% endfor %}</select>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Reference (Laboratory) -->
        <h4 class="mt-5 text-warning">Reference (Laboratory)</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label>55. Start time:</label>
            <input type="time" name="lab_start_time">
          </div>
          <div>
            <label>56. Venous Hb value (ABX Micros ES 60): _____ g/dL</label>
            <input type="number" step="0.1" name="lab_hb_value" placeholder="Hb value">
          </div>
          <div>
            <label>57. Number of attempts:</label>
            <div style="display: flex; gap: 20px;">
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="lab_attempts"
                  value="1" style="width: auto;"> 1</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="lab_attempts"
                  value="2" style="width: auto;"> 2</label>
              <label style="display: flex; align-items: center; gap: 8px;"><input type="radio" name="lab_attempts"
                  value=">=3" style="width: auto;"> ≥3</label>
            </div>
          </div>
          <div>
            <label>58. End time:</label>
            <input type="time" name="lab_end_time">
          </div>
        </div>

        <label class="mt-3">59. FLACC Scale (Lab):</label>
        <table>
          <thead>
            <tr>
              <th>Component</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Face</td>
              <td><select name="lab_flacc_face" class="flacc_lab">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Legs</td>
              <td><select name="lab_flacc_legs" class="flacc_lab">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Activity</td>
              <td><select name="lab_flacc_activity" class="flacc_lab">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Cry</td>
              <td><select name="lab_flacc_cry" class="flacc_lab">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
            <tr>
              <td>Consolability</td>
              <td><select name="lab_flacc_consolability" class="flacc_lab">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                </select></td>
            </tr>
          </tbody>
        </table>
        <div class="score">Total score: <input name="lab_flacc_total" id="lab_flacc_total" readonly> /10</div>

        <h5 class="mt-4">Operational Feasibility Questions (Reference Lab)</h5>
        <table>
          <thead>
            <tr>
              <th>Section</th>
              <th>Question</th>
              <th>Response</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>60. Ease of Operation & Workflow</td>
              <td>Is it easy to operate?</td>
              <td><select name="lab_feas_60_a">
                  <option>Very easy</option>
                  <option>Easy</option>
                  <option>Moderate</option>
                  <option>Difficult</option>
                </select></td>
            </tr>
            <tr>
              <td>63. Average time required to obtain a result:</td>
              <td>Horiba Device</td>
              <td><select name="lab_feas_63_c">
                  <option>&lt;1 min</option>
                  <option>1–3 min</option>
                  <option>&gt;3 min</option>
                </select></td>
            </tr>
            <tr>
              <td>70. Overall Operational Feasibility</td>
              <td>Rate overall feasibility</td>
              <td><select name="lab_overall_feas">{% for i in range(1,6) %}<option>{{ i }}</option>{% endfor %}</select>
              </td>
            </tr>
          </tbody>
        </table>

      </div>

      <!-- ================= SECTION I ================= -->
      <div class="section">
        <h3>Section I: Parental Acceptability (Scale 1–5)</h3>
        <p class="text-muted mb-3">1 = Strongly Disagree, 2 = Disagree, 3 = Neutral, 4 = Agree, 5 = Strongly Agree</p>

        <table>
          <thead>
            <tr>
              <th>No.</th>
              <th>Statement</th>
              <th>Score (1–5)</th>
            </tr>
          </thead>
          <tbody>
            {% set statements = [
            (73, 'I was comfortable with this Hb test for my child'),
            (74, 'My child appeared calm during the test'),
            (75, 'The test caused pain or distress to my child', 'reverse'),
            (76, 'I believe this test is safe for young children'),
            (77, 'I trust the Hb result obtained from this test'),
            (78, 'The test was completed quickly'),
            (79, 'This test is acceptable for children aged 3–5 years'),
            (80, 'I would allow this test again for my child'),
            (81, 'I would recommend this test to other parents')
            ] %}
            {% for no, text, type in statements %}
            <tr>
              <td>{{ no }}</td>
              <td>{{ text }}{% if type == 'reverse' %} (Reverse Scored){% endif %}</td>
              <td>
                <select name="parent_q_{{ no }}" class="parent_score" {% if type=='reverse' %}data-reverse="true" {%
                  endif %}>
                  {% for i in range(1,6) %}<option value="{{ i }}">{{ i }}</option>{% endfor %}
                </select>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="score">Total Parental Acceptability Score: <input id="parent_total" name="parent_total" readonly>
          /45</div>
      </div>

      <!-- ================= SECTION J ================= -->
      <div class="section">
        <h3>Section J: Referral & Action Taken</h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label>82. Child classified as:</label>
            <input type="text" id="child_classification" name="child_classification" readonly
              placeholder="Auto-calculated from Lab Hb">
          </div>
          <div>
            <label>83. Dose of IFA:</label>
            <input type="text" id="ifa_dose" name="ifa_dose" placeholder="Auto-calculated (Editable)">
          </div>
          <div>
            <label>84. Referral advised?</label>
            <select name="referral_advised">
              <option>No</option>
              <option>Yes</option>
            </select>
          </div>
          <div>
            <label>85. Referral destination:</label>
            <select name="referral_destination">
              <option>None</option>
              <option>PHC</option>
              <option>UHC</option>
              <option>Govt. Hospital</option>
              <option>Anganwadi</option>
              <option>Private clinic</option>
              <option>Other</option>
            </select>
          </div>
        </div>

        <div class="mt-3">
          <label>Referral destination (Others specify):</label>
          <input type="text" name="referral_other" placeholder="Specify if other">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;" class="mt-4">
          <div>
            <label>Investigator Signature:</label>
            <input type="text" name="investigator_name" placeholder="Name/Signature">
          </div>
          <div>
            <label>Date:</label>
            <input type="date" name="referral_date">
          </div>
        </div>
      </div>

      <!-- submit footer -->
      <div class="form-footer">
        <button type="submit"><i class="fas fa-paper-plane"></i> Submit Questionnaire</button>
      </div>
    </form>
  </div>

  <script>
    /* KUPPUSWAMY CALCULATIONS */
    function calcKupp() {
      const edu = parseInt(document.getElementById('edu_head').value) || 0;
      const occ = parseInt(document.getElementById('occ_head').value) || 0;
      const inc = parseInt(document.getElementById('income').value) || 0;
      const total = edu + occ + inc;
      const scoreOutput = document.getElementById('kupp_total');
      const sesOutput = document.getElementById('ses_class');

      if (scoreOutput) scoreOutput.value = total;

      let classification = "";
      if (total >= 26) classification = "Upper";
      else if (total >= 16) classification = "Upper Middle";
      else if (total >= 11) classification = "Lower Middle";
      else if (total >= 5) classification = "Upper Lower";
      else classification = "Lower";

      if (sesOutput) sesOutput.value = classification;
    }

    /* PARENTAL ACCEPTABILITY SCORE */
    function calcParent() {
      let total = 0;
      document.querySelectorAll(".parent_score").forEach(e => {
        let v = parseInt(e.value) || 0;
        if (e.dataset.reverse === "true") v = 6 - v;
        total += v;
      });
      const pt = document.getElementById('parent_total');
      if (pt) pt.value = total;
    }

    /* ANEMIA CLASSIFICATION & IFA DOSAGE */
    function updateClinicalCalculations() {
      const hbInput = document.getElementsByName('lab_hb_value')[0];
      const weightInput = document.getElementById('weight_input');
      const classificationInput = document.getElementById('child_classification');
      const doseInput = document.getElementById('ifa_dose');

      const hb = hbInput ? parseFloat(hbInput.value) : NaN;
      const weight = weightInput ? parseFloat(weightInput.value) : NaN;

      // Update Classification
      if (!Number.isNaN(hb)) {
        if (hb >= 11) classificationInput.value = "Non-anaemic";
        else classificationInput.value = "Anaemic";
      } else {
        classificationInput.value = "";
      }

      // Update IFA Dose
      if (!Number.isNaN(hb) && !Number.isNaN(weight)) {
        doseInput.value = calculateIfaDose(weight, hb);
      } else {
        doseInput.value = "";
      }
    }

    function calculateIfaDose(weight, hb) {
      if (hb >= 11) return "No therapeutic syrup dose";
      if (hb < 5) return "5 to 7.5 ml/day (urgent referral)";
      if (hb < 7) return "7.5 to 9 ml/day (urgent referral)";
      if (hb < 8) return "8 to 9 ml/day";
      if (hb < 9) return weight < 12 ? "8 to 9 ml/day" : "9 to 10 ml/day";
      if (hb < 10) return "9 to 10 ml/day";
      if (hb < 11) return weight >= 15.5 ? "5 to 7.5 ml/day" : "8 to 9 ml/day";
      return "";
    }

    /* FLACC SCALE CALCULATION */
    function calcFlaccGroup(groupClass, outputId) {
      let total = 0;
      document.querySelectorAll('.' + groupClass).forEach(el => {
        total += parseInt(el.value) || 0;
      });
      const output = document.getElementById(outputId);
      if (output) output.value = total;
    }

    /* EVENT LISTENERS */
    document.addEventListener("change", e => {
      if (['edu_head', 'occ_head', 'income'].includes(e.target.id)) calcKupp();
      if (e.target.classList.contains("parent_score")) calcParent();
      if (e.target.name === "lab_hb_value" || e.target.id === "weight_input") updateClinicalCalculations();

      if (e.target.classList.contains("flacc_masimo")) calcFlaccGroup("flacc_masimo", "masimo_flacc_total");
      if (e.target.classList.contains("flacc_poc")) calcFlaccGroup("flacc_poc", "poc_flacc_total");
      if (e.target.classList.contains("flacc_lab")) calcFlaccGroup("flacc_lab", "lab_flacc_total");
    });

    document.addEventListener("input", e => {
      if (e.target.name === "lab_hb_value" || e.target.id === "weight_input") updateClinicalCalculations();
    });

    // Initialize on load
    document.addEventListener("DOMContentLoaded", () => {
      calcKupp();
      calcParent();
      updateClinicalCalculations();
      calcFlaccGroup("flacc_masimo", "masimo_flacc_total");
      calcFlaccGroup("flacc_poc", "poc_flacc_total");
      calcFlaccGroup("flacc_lab", "lab_flacc_total");
    });
  </script>

</body>

</html>