<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horiba</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="logo"><i class="fas fa-chart-line"></i> SURVEYPRO</div>
        <div class="ms-auto">
            <button class="nav-btn" onclick="location.href='/'"><i class="fas fa-home"></i> Dashboard</button>
            <button class="nav-btn" onclick="location.href='/profile'"><i class="fas fa-user-circle"></i>
                Profile</button>
            <button class="nav-btn" onclick="location.href='/form'"><i class="fas fa-question-circle"></i>
                Questions</button>
        </div>
    </div>
    <!-- Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Machines</h3>
                <p>Select Machine</p>
            </div>
            <div class="steps">
                <div class="step" onclick="location.href='/masimo'">
                    <div class="step-icon">1</div>
                    <div class="step-info">
                        <h4>Masimo</h4>
                        <p>Online</p>
                    </div>
                </div>
                <div class="step" onclick="location.href='/hemocue'">
                    <div class="step-icon">2</div>
                    <div class="step-info">
                        <h4>Hemocue</h4>
                        <p>Standby</p>
                    </div>
                </div>
                <div class="step active" onclick="location.href='/horiba'">
                    <div class="step-icon">3</div>
                    <div class="step-info">
                        <h4>Horiba</h4>
                        <p>Offline</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Main -->
        <div class="main-content">
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <!-- Flash Messages -->
            {% with messages = get_flashed_messages() %}
            {% if messages %}
            {% for message in messages %}
            <div class="alert {% if 'Error' in message %}alert-danger{% else %}alert-success{% endif %}" role="alert"
                style="margin-bottom: 20px; border-radius: 10px;">
                {{ message }}
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}
            <div class="welcome-card" style="max-width: 95%; width: 95%;">
                <div class="welcome-icon"><i class="fas fa-microscope"></i></div>
                <h1>Horiba Manual Entry</h1>
                <p>Enter Horiba readings for participants manually below.</p>

                <div style="margin-top:20px; text-align:left;">
                    <div
                        style="overflow-x:auto; background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px;">
                        <table style="width:100%; color: white; border-collapse: collapse;">
                            <thead>
                                <tr style="border-bottom: 2px solid rgba(255,255,255,0.1); text-align: left;">
                                    <th style="padding: 12px;">Profile ID</th>
                                    <th style="padding: 12px;">Name</th>
                                    <th style="padding: 12px;">Masimo</th>
                                    <th style="padding: 12px;">Hemocue</th>
                                    <th style="padding: 12px; width: 250px;">Horiba (Manual)</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in profiles %}
                                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                                    <td style="padding: 12px;">{{ p.profile_id }}</td>
                                    <td style="padding: 12px;">{{ p.name }}</td>
                                    <td style="padding: 12px; color: #aaa;">{{ p.masimo if p.masimo else '-' }}</td>
                                    <td style="padding: 12px; color: #aaa;">{{ p.hemocue if p.hemocue else '-' }}</td>
                                    <td style="padding: 12px;">
                                        <div style="display:flex; gap: 8px;">
                                            <input type="text" id="horiba_{{ p.profile_id }}" value="{{ p.horiba }}"
                                                style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); border-radius:6px; padding:5px 10px; color:white; width: 100px;">
                                            <button class="cta-button" onclick="updateHoriba('{{ p.profile_id }}')"
                                                style="padding: 5px 15px; font-size: 13px; margin-top:0;">Update</button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div style="display:flex; gap:15px; justify-content:center; margin-top: 25px;">
                        <button class="cta-button" onclick="location.href='/masimo'"
                            style="background: linear-gradient(135deg, #007bff, #00bfff);">Go to Masimo</button>
                    </div>
                </div>
            </div>

            <script>
                function updateHoriba(profileId) {
                    const val = document.getElementById('horiba_' + profileId).value;
                    const formData = new FormData();
                    formData.append('profile_id', profileId);
                    formData.append('horiba', val);

                    fetch('/update-horiba', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('Updated successfully for ' + profileId);
                            } else {
                                alert('Error: ' + data.error);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('An error occurred while updating.');
                        });
                }
            </script>
        </div>
    </div>
</body>

</html>
