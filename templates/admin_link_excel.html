<!DOCTYPE html>
<html>
<head>
  <title>Admin - Link Excel with Barcode</title>
</head>
<body style="font-family: Arial; background:#f4f6f9;">
  <div style="width:95%;margin:30px auto;background:white;padding:20px;border-radius:12px;box-shadow:0 5px 15px rgba(0,0,0,0.2);">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;">
      <h2 style="margin:0;">Upload Excel and Link with Student Barcode</h2>
      <a href="/admin-dashboard" style="padding:10px 14px;background:#007bff;color:white;text-decoration:none;border-radius:10px;font-weight:bold;">
        Back
      </a>
    </div>

    <hr>

    <p style="color:#555; margin-bottom:10px;">
      Upload an Excel file with a barcode column. Supported column names:
      <b>profile_id</b>, <b>barcode</b>, <b>barcode_id</b>, <b>student_barcode</b>.
    </p>

    <form method="POST" enctype="multipart/form-data" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
      <input type="file" name="file" accept=".xlsx,.xls" required
             style="padding:8px;border:1px solid #ccc;border-radius:8px;background:#fff;">
      <button type="submit" style="padding:10px 14px;background:#ff8800;color:white;border:none;border-radius:10px;font-weight:bold;cursor:pointer;">
        Upload and Link
      </button>
      <a href="/admin/download/linked_data.csv" style="padding:10px 14px;background:#198754;color:white;text-decoration:none;border-radius:10px;font-weight:bold;">
        Export linked_data.csv
      </a>
      <a href="/admin/download/linked_data.xlsx" style="padding:10px 14px;background:#198754;color:white;text-decoration:none;border-radius:10px;font-weight:bold;">
        Export linked_data.xlsx
      </a>
    </form>

    {% if error %}
      <div style="margin-top:14px;padding:10px;border-radius:8px;background:#ffe3e3;color:#b02a37;border:1px solid #f5c2c7;">
        {{ error }}
      </div>
    {% endif %}

    {% if success %}
      <div style="margin-top:14px;padding:10px;border-radius:8px;background:#e6ffed;color:#146c43;border:1px solid #badbcc;">
        {{ success }}
      </div>
    {% endif %}

    <hr>

    <h3 style="margin-top:0;">Linked Excel Data View</h3>
    {% if data|length == 0 %}
      <p style="color:#666;">No linked data available. Upload an Excel file first.</p>
    {% else %}
      <p style="color:#666;">Total linked rows: <b>{{ data|length }}</b></p>
      <div style="overflow-x:auto;">
        <table border="1" cellpadding="8" cellspacing="0" style="width:100%;border-collapse:collapse;font-size:13px;">
          <tr style="background:#0d6efd;color:#fff;">
            {% for key in headers %}
              <th style="white-space:nowrap;">{{ key }}</th>
            {% endfor %}
          </tr>
          {% for row in data %}
            <tr>
              {% for key in headers %}
                <td>{{ row.get(key, "") }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </table>
      </div>
    {% endif %}
  </div>
</body>
</html>
